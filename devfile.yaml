schemaVersion: 2.2.0
metadata:
  name: kube-santa
  version: 1.0.0
  displayName: Kube Santa
  description: Kubernetes の概念をクリスマスの世界観で学ぶ教育用 Web アプリケーション
  tags:
    - react
    - typescript
    - vite
    - playwright
    - education
  projectType: "Node.js"
  language: "JavaScript"  

components:
  - name: nodejs
    container:
      image: registry.access.redhat.com/ubi10/nodejs-22:10.1
      memoryLimit: 2Gi
      cpuLimit: "1"
      mountSources: true
      env:
        - name: NODE_ENV
          value: development
        - name: PLAYWRIGHT_BROWSERS_PATH
          value: ${PROJECT_SOURCE}/.cache/ms-playwright
        - name: CI
          value: "true"
      endpoints:
        - name: vite-dev-server
          targetPort: 5173
          exposure: public
          protocol: http
          path: /
          attributes:
            public: 'true'
            cookiesAuthEnabled: 'false'
        - name: vite-preview
          targetPort: 4173
          exposure: public
          protocol: http
          path: /
          attributes:
            public: 'true'
            cookiesAuthEnabled: 'false'
      command:
        - sleep
        - infinity

commands:
  - id: install
    exec:
      component: nodejs
      commandLine: |
        npm install && \
        npx playwright install chromium
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: build
        isDefault: true

  - id: clean-install
    exec:
      component: nodejs
      commandLine: |
        rm -rf node_modules package-lock.json && \
        npm install && \
        npx playwright install chromium
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: build

  - id: dev
    exec:
      component: nodejs
      commandLine: npm run dev
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: run
        isDefault: true
      hotReloadCapable: true

  - id: build
    exec:
      component: nodejs
      commandLine: npm run build
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: build

  - id: preview
    exec:
      component: nodejs
      commandLine: npm run preview
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: run

  - id: test-e2e
    exec:
      component: nodejs
      commandLine: npm run test:e2e
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: test
        isDefault: true

  - id: test-e2e-ui
    exec:
      component: nodejs
      commandLine: npx playwright test --ui
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: test

  - id: test-e2e-headed
    exec:
      component: nodejs
      commandLine: npx playwright test --headed
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: test

  - id: test-e2e-debug
    exec:
      component: nodejs
      commandLine: npx playwright test --debug
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: test

